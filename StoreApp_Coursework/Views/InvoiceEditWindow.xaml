<Window x:Class="StoreApp.Views.InvoiceEditWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:helpers="clr-namespace:StoreApp.Helpers"
        Title="Накладна" Height="500" Width="850" 
        WindowStartupLocation="CenterOwner" ResizeMode="NoResize">

    <Window.Resources>
        <helpers:InvoiceItemSumConverter x:Key="InvoiceItemSumConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border BorderBrush="Gray" BorderThickness="0,0,0,1" Padding="0,0,0,10" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">

                <StackPanel Margin="0,0,15,0">
                    <TextBlock Text="Номер:" Foreground="Gray"/>
                    <TextBox Text="{Binding Invoice.Number}" Width="80" IsReadOnly="True" Background="#F5F5F5" Height="25" VerticalContentAlignment="Center"/>
                </StackPanel>

                <StackPanel Margin="0,0,15,0">
                    <TextBlock Text="Дата:" Foreground="Gray"/>
                    <StackPanel Orientation="Horizontal">
                        <TextBox x:Name="TxtDateDisplay" Text="{Binding Invoice.Date, StringFormat=dd.MM.yyyy}" Width="90" IsReadOnly="True" Height="25" VerticalContentAlignment="Center"/>

                        <Button Content=" 📅 " Width="30" Height="25" Margin="5,0,0,0" Click="BtnCalendar_Click" Background="#EEEEEE"
                                IsEnabled="{Binding IsEditing}"/>

                        <DatePicker Name="HiddenDatePicker" Width="0" Height="0" Focusable="False" 
                                    SelectedDateChanged="HiddenDatePicker_SelectedDateChanged" Visibility="Hidden"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Margin="0,0,15,0">
                    <TextBlock Text="Тип операції:" Foreground="Gray"/>
                    <ComboBox ItemsSource="{Binding InvoiceTypes}" 
                              SelectedItem="{Binding SelectedType}"
                              IsEnabled="{Binding CanChangeType}"
                              Width="140" Height="25" VerticalContentAlignment="Center"/>
                </StackPanel>

                <StackPanel>
                    <TextBlock Text="{Binding CounterpartyLabel}" Foreground="Gray"/>
                    <TextBox Text="{Binding Invoice.Customer, UpdateSourceTrigger=PropertyChanged}" 
                             IsReadOnly="{Binding IsReadOnly}"
                             Width="200" Height="25" VerticalContentAlignment="Center"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <ListView Grid.Row="1" ItemsSource="{Binding Items}" SelectionMode="Single">
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Назва" Width="250" DisplayMemberBinding="{Binding Name}"/>
                    <GridViewColumn Header="К-сть" Width="70" DisplayMemberBinding="{Binding Quantity}"/>
                    <GridViewColumn Header="Од." Width="60" DisplayMemberBinding="{Binding Unit}"/>
                    <GridViewColumn Header="Ціна" Width="90" DisplayMemberBinding="{Binding Price}"/>
                    <GridViewColumn Header="Сума" Width="100">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Path=., Converter={StaticResource InvoiceItemSumConverter}}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>

        <StackPanel Grid.Row="2" Margin="0,15,0,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,5">
                <Button Content="+ Обрати товар" Command="{Binding AddItemCommand}" 
                        Visibility="{Binding IsEditing, Converter={StaticResource BoolToVis}}"
                        Width="120" Height="30"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,10">
                <TextBlock Text="РАЗОМ:" FontWeight="Bold" FontSize="14" Margin="0,0,10,0"/>
                <TextBlock Text="{Binding Invoice.Total, StringFormat=F2}" FontSize="16" FontWeight="Bold"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <Button Content="Зберегти та провести" Command="{Binding SaveCommand}" 
                        Visibility="{Binding IsEditing, Converter={StaticResource BoolToVis}}"
                        Background="#4CAF50" Foreground="White" Width="160" Height="30"/>

                <Button Content="Закрити" Command="{Binding CancelCommand}" Margin="10,0,0,0" Width="100" Height="30"/>
            </StackPanel>
        </StackPanel>
    </Grid>
</Window>